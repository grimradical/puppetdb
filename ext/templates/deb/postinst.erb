#!/bin/sh

set -e

if [ "$1" = "configure" ]; then

    # Create the "<%= @user -%>" user
    if ! getent passwd <%= @user -%>  > /dev/null; then
        adduser --quiet --system --group --home <%= @install_dir -%>  \
            --no-create-home                                 \
            --gecos "Puppet StoredConfigs daemon" \
            <%= @user %>
    fi

        # Create the "<%= @user -%>" group, if it is missing, and set the
        # primary group of the "<%= @user -%>" user to this group.
        if ! getent group <%= @user -%> > /dev/null; then
            addgroup --quiet --system <%= @user %>
            usermod -g <%= @user -%> <%= @user %>
        fi

    # Set correct permissions and ownership for puppetdb directories
    if ! dpkg-statoverride --list <%= @log_dir -%> >/dev/null 2>&1; then
    dpkg-statoverride --update --add <%= @name -%>  <%= @name -%> 0750 <%= @log_dir %>
    fi

    if ! dpkg-statoverride --list <%= @install_dir -%> >/dev/null 2>&1; then
        dpkg-statoverride --update --add <%= @user -%>  <%= @user -%> 0700 <%= @install_dir %>
    fi

    if ! dpkg-statoverride --list <%= @config_dir -%> >/dev/null 2>&1; then
        dpkg-statoverride --update --add <%= @user -%>  <%= @user -%> 0700 <%= @config_dir %>
    fi


fi

#DEBHELPER#
